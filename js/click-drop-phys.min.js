function round(a){return.5+a|0}function randInt(a,i){return Math.floor(Math.random()*(i-a+1)+a)}function loadImage(a,i){var e={};e.canvas=document.createElement("canvas"),e.ctx=e.canvas.getContext("2d");var t=new Image;return t.onload=function(){var a=t.width/t.height;e.canvas.width=2*i*a,e.canvas.height=2*i,e.ctx.drawImage(t,0,0,e.canvas.width,e.canvas.height)},t.src=a,e}function Box(a,i,e,t,o){this.body=null,this.width=i,this.height=e;var n=new b2BodyDef;n.type=b2Body.b2_dynamicBody,n.position.x=t,n.position.y=o,this.body=a.CreateBody(n);var r=new b2PolygonShape;r.SetAsBox(i,e,.5);var s=new b2FixtureDef;s.shape=r,s.density=1,this.body.CreateFixture(s)}function CachedImageBox(a,i,e,t,o){this.image=i,this.radius=this.calculateRadius();var n=new b2BodyDef;n.type=b2Body.b2_dynamicBody,n.position.x=e,n.position.y=t,this.body=a.CreateBody(n);var r=new b2FixtureDef;r.shape=new b2PolygonShape;var s=this.image.canvas.width/(2*o),c=this.image.canvas.height/(2*o);r.shape.SetAsBox(s,c,.5),r.density=1,this.body.CreateFixture(r)}function clickDropInit(a){function i(){if(clickDropVariables.things=clickDropVariables.things.filter(function(a){return a.stillIn(clickDropVariables.canvas,clickDropVariables.scale)}),clickDropVariables.things.length>0){clickDropVariables.things.map(function(a){return a.body.GetPosition()});var a=clickDropVariables.things.map(function(a){return a.leftBoundDistance(clickDropVariables.scale)}).sort(function(a,i){return a-i}),e=clickDropVariables.things.map(function(a){return a.rightBoundDistance(clickDropVariables.scale)}).sort(function(a,i){return i-a}),t=clickDropVariables.things.map(function(a){return a.topBoundDistance(clickDropVariables.scale)}).sort(function(a,i){return a-i}),o=clickDropVariables.things.map(function(a){return a.bottomBoundDistance(clickDropVariables.scale)}).sort(function(a,i){return i-a}),n=a[0],r=e[0],s=t[0],c=o[0];clickDropVariables.ctx.clearRect(n,s,Math.abs(r-n),Math.abs(c-s))}clickDropVariables.things.forEach(function(a){a.render(clickDropVariables.ctx,clickDropVariables.scale)}),world.Step(1/60,10,10),world.ClearForces(),requestAnimationFrame(i)}(clickDropVariables={}).scale=a.scale,clickDropVariables.images=new Array,a.images.forEach(function(a){clickDropVariables.images.push(loadImage(a,clickDropVariables.scale))}),clickDropVariables.things=new Array,clickDropVariables.world=new b2World(new b2Vec2(0,50),!0),clickDropVariables.canvas=document.createElement("canvas"),clickDropVariables.canvas.style.position="fixed",clickDropVariables.canvas.style.top="0px",clickDropVariables.canvas.style.left="0px",clickDropVariables.canvas.style.zIndex=3,clickDropVariables.canvas.style.pointerEvents="none",clickDropVariables.ctx=clickDropVariables.canvas.getContext("2d"),document.getElementsByTagName("body")[0].appendChild(clickDropVariables.canvas),window.onmousedown=function(a){var i=new CachedImageBox(world,clickDropVariables.images[randInt(0,clickDropVariables.images.length-1)],a.clientX/clickDropVariables.scale,a.clientY/clickDropVariables.scale,clickDropVariables.scale);clickDropVariables.things.push(i);var e=10*randInt(-100,100)/clickDropVariables.scale,t=10*randInt(-500,-100)/clickDropVariables.scale;i.body.ApplyImpulse(new b2Vec2(e,t),i.body.GetWorldCenter()),i.body.ApplyTorque(randInt(-500,500))},window.onresize=function(){clickDropVariables.canvas.width=window.innerWidth,clickDropVariables.canvas.height=window.innerHeight},window.onresize(),world=new b2World(new b2Vec2(0,40),!0),i()}var b2Vec2=Box2D.Common.Math.b2Vec2,b2BodyDef=Box2D.Dynamics.b2BodyDef,b2Body=Box2D.Dynamics.b2Body,b2FixtureDef=Box2D.Dynamics.b2FixtureDef,b2Fixture=Box2D.Dynamics.b2Fixture,b2World=Box2D.Dynamics.b2World,b2MassData=Box2D.Collision.Shapes.b2MassData,b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape,b2CircleShape=Box2D.Collision.Shapes.b2CircleShape,b2DebugDraw=Box2D.Dynamics.b2DebugDraw,b2Transform=Box2D.Common.Math.b2Transform,b2Mat22=Box2D.Common.Math.b2Mat22;Box.prototype.render=function(a,i){var e=this.body.GetPosition();a.save(),a.strokeStyle="#000000",a.translate(e.x*i,e.y*i),a.rotate(this.body.GetAngle()),a.beginPath(),a.moveTo(-1*this.width*i,-1*this.height*i),a.lineTo(this.width*i,-1*this.height*i),a.lineTo(this.width*i,this.height*i),a.lineTo(-1*this.width*i,this.height*i),a.lineTo(-1*this.width*i,-1*this.height*i),a.closePath(),a.stroke(),a.restore()},CachedImageBox.prototype.render=function(a,i){var e=this.body.GetPosition();a.save(),a.translate(e.x*i,e.y*i),a.rotate(this.body.GetAngle()),a.drawImage(this.image.canvas,-1*round(this.image.canvas.width/2),-1*round(this.image.canvas.height/2)),a.restore()},CachedImageBox.prototype.calculateRadius=function(){var a=this.image.canvas.width/2,i=this.image.canvas.height/2;return Math.sqrt(a*a+i*i)+60},CachedImageBox.prototype.topBoundDistance=function(a){return this.body.GetPosition().y*a-this.radius},CachedImageBox.prototype.bottomBoundDistance=function(a){return this.body.GetPosition().y*a+this.radius},CachedImageBox.prototype.leftBoundDistance=function(a){return this.body.GetPosition().x*a-this.radius},CachedImageBox.prototype.rightBoundDistance=function(a){return this.body.GetPosition().x*a+this.radius},CachedImageBox.prototype.stillIn=function(a,i){return this.body.GetPosition().y*i-this.radius<=a.height};var clickDropVariables=null;